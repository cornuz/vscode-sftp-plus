{
  "name": "sftp-plus",
  "displayName": "SFTP+ MCP",
  "description": "Full read/write access to SFTP/FTPS servers with GitHub Copilot integration",
  "version": "0.2.1",
  "publisher": "cornuz-design",
  "author": {
    "name": "Raphael Cornuz",
    "url": "https://cornuz.com"
  },
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/cornuz/vscode-sftp-plus"
  },
  "bugs": {
    "url": "https://github.com/cornuz/vscode-sftp-plus/issues"
  },
  "homepage": "https://github.com/cornuz/vscode-sftp-plus#readme",
  "engines": {
    "vscode": "^1.96.0"
  },
  "categories": [
    "Other"
  ],
  "keywords": [
    "sftp",
    "ftp",
    "ftps",
    "remote",
    "mount",
    "rclone",
    "winfsp"
  ],
  "icon": "resources/icon.png",
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./dist/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "sftp-plus.connect",
        "title": "SFTP+: Connect",
        "icon": "$(plug)"
      },
      {
        "command": "sftp-plus.disconnect",
        "title": "SFTP+: Disconnect",
        "icon": "$(debug-disconnect)"
      },
      {
        "command": "sftp-plus.disconnectAll",
        "title": "SFTP+: Disconnect All"
      },
      {
        "command": "sftp-plus.addConnection",
        "title": "SFTP+: Add Connection",
        "icon": "$(add)"
      },
      {
        "command": "sftp-plus.editConnection",
        "title": "SFTP+: Edit Connection",
        "icon": "$(edit)"
      },
      {
        "command": "sftp-plus.removeConnection",
        "title": "SFTP+: Remove Connection",
        "icon": "$(trash)"
      },
      {
        "command": "sftp-plus.checkPrerequisites",
        "title": "SFTP+: Check Prerequisites"
      },
      {
        "command": "sftp-plus.installRclone",
        "title": "SFTP+: Install rclone"
      },
      {
        "command": "sftp-plus.installWinFsp",
        "title": "SFTP+: Install WinFsp"
      },
      {
        "command": "sftp-plus.downloadWinFsp",
        "title": "SFTP+: Download WinFsp"
      },
      {
        "command": "sftp-plus.showPrerequisiteDetails",
        "title": "SFTP+: Show Prerequisite Details"
      },
      {
        "command": "sftp-plus.refresh",
        "title": "SFTP+: Refresh",
        "icon": "$(refresh)"
      },
      {
        "command": "sftp-plus.browseConnection",
        "title": "SFTP+: Browse Files",
        "icon": "$(folder-library)"
      },
      {
        "command": "sftp-plus.openInExplorer",
        "title": "SFTP+: Open in File Explorer",
        "icon": "$(folder-opened)"
      },
      {
        "command": "sftp-plus.startMcp",
        "title": "SFTP+: Enable Copilot Access",
        "icon": "$(copilot)"
      },
      {
        "command": "sftp-plus.stopMcp",
        "title": "SFTP+: Disable Copilot Access",
        "icon": "$(copilot)"
      },
      {
        "command": "sftp-plus.toggleAiWrite",
        "title": "SFTP+: Toggle AI Write Access",
        "icon": "$(copilot)"
      },
      {
        "command": "sftp-plus.allowAiWriteFolder",
        "title": "SFTP+: Allow AI Write on Folder"
      },
      {
        "command": "sftp-plus.revokeAiWriteFolder",
        "title": "SFTP+: Revoke AI Write on Folder"
      },
      {
        "command": "sftp-plus.uploadToHost",
        "title": "SFTP+: Upload to Host",
        "icon": "$(cloud-upload)"
      }
    ],
    "languageModelTools": [
      {
        "name": "sftp-plus_list_connections",
        "displayName": "List Connections",
        "toolReferenceName": "sftp-connections",
        "icon": "$(tools)",
        "modelDescription": "Lists all SFTP/FTP connections configured in SFTP+ extension and their MCP (Copilot access) status. Use this to discover available remote servers before accessing files.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {}
        }
      },
      {
        "name": "sftp-plus_list_files",
        "displayName": "List Files",
        "toolReferenceName": "sftp-ls",
        "icon": "$(tools)",
        "modelDescription": "Lists files and folders on a remote SFTP/FTP server. Returns JSON with name, type, path, size (bytes), and modified (ISO date) for each item. Supports recursive listing to get entire directory tree in one call. Use recursive=true with maxDepth for deep exploration instead of calling list_files multiple times.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to use. Use sftp-plus_list_connections to see available connections."
            },
            "path": {
              "type": "string",
              "description": "Remote path to list. Use '/' for root or omit for the configured remote path. Example: '/var/www'"
            },
            "recursive": {
              "type": "boolean",
              "description": "If true, recursively list all files and folders in subdirectories. Default is false. Use this to get entire directory tree in one call."
            },
            "maxDepth": {
              "type": "number",
              "description": "Maximum depth for recursive listing. Default is 10. Only used when recursive=true."
            }
          },
          "required": ["connectionName"]
        }
      },
      {
        "name": "sftp-plus_read_file",
        "displayName": "Read File",
        "toolReferenceName": "sftp-read",
        "icon": "$(tools)",
        "modelDescription": "Reads the content of a file from a remote SFTP/FTP server. Requires the connection to have Copilot access enabled. Returns the file content as text.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to use."
            },
            "path": {
              "type": "string",
              "description": "Remote path to the file to read. Example: '/var/www/index.html'"
            }
          },
          "required": ["connectionName", "path"]
        }
      },
      {
        "name": "sftp-plus_write_file",
        "displayName": "Write File (Direct - No Diff)",
        "toolReferenceName": "sftp-write",
        "icon": "$(tools)",
        "modelDescription": "DEPRECATED for editing existing files - use sftp-plus_prepare_edit instead! This tool writes DIRECTLY to the server WITHOUT showing the user a diff preview. Only use this for: 1) Creating NEW files that don't exist yet, 2) Automated batch operations where diff preview is not needed. For editing existing files, ALWAYS use sftp-plus_prepare_edit first to download the file locally, then use standard Copilot edit tools.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to use."
            },
            "path": {
              "type": "string",
              "description": "Remote path where to write the file. Example: '/var/www/config.json'"
            },
            "content": {
              "type": "string",
              "description": "Content to write to the file."
            }
          },
          "required": ["connectionName", "path", "content"]
        }
      },
      {
        "name": "sftp-plus_prepare_edit",
        "displayName": "Prepare File for Edit (Recommended)",
        "toolReferenceName": "sftp-edit",
        "icon": "$(tools)",
        "modelDescription": "ALWAYS USE THIS to edit existing files on remote servers! Downloads the file to local workspace, opens it in VS Code, then you can use standard Copilot edit tools (replace_string_in_file, etc.) which show the user a diff preview. The user can accept/reject changes before syncing back to server. This is the PREFERRED method for all file modifications.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection."
            },
            "path": {
              "type": "string",
              "description": "Remote path of the file to prepare for editing. Example: '/var/www/config.json'"
            }
          },
          "required": ["connectionName", "path"]
        }
      },
      {
        "name": "sftp-plus_list_writable_paths",
        "displayName": "List Writable Paths",
        "toolReferenceName": "sftp-writable",
        "icon": "$(tools)",
        "modelDescription": "Lists all files and folders that have write access enabled for AI on a specific SFTP+ connection. Use this before attempting to write to check permissions.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to check."
            }
          },
          "required": ["connectionName"]
        }
      },
      {
        "name": "sftp-plus_request_write_access",
        "displayName": "Request Write Access",
        "toolReferenceName": "sftp-request-write",
        "icon": "$(tools)",
        "modelDescription": "ALWAYS use this first when you need to modify a file! Asks the user for write permission with two modes: LOCAL (downloads file for editing with diff preview - RECOMMENDED) or HOST (direct server write). If LOCAL mode is chosen, returns the local file path to use with standard Copilot edit tools.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection."
            },
            "path": {
              "type": "string",
              "description": "Remote path to request write access for. Example: '/var/www/config.json'"
            }
          },
          "required": ["connectionName", "path"]
        }
      },
      {
        "name": "sftp-plus_search_files",
        "displayName": "Search Files",
        "toolReferenceName": "sftp-search",
        "icon": "$(tools)",
        "modelDescription": "PREFERRED for finding files. Searches for files matching a pattern (glob or regex) on a remote SFTP/FTP server. Much faster than calling list_files multiple times. Use this to find files by name pattern across the entire server or a subtree.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to use."
            },
            "pattern": {
              "type": "string",
              "description": "Search pattern. Supports glob patterns (*.txt, test-*, **/*.js) or regex if useRegex=true. Examples: '*.log', 'config.*', 'test-big*', '**/*.json'"
            },
            "path": {
              "type": "string",
              "description": "Starting path for the search. Default is root '/'. Example: '/var/www'"
            },
            "useRegex": {
              "type": "boolean",
              "description": "If true, treat pattern as a regex instead of glob. Default is false (glob)."
            },
            "type": {
              "type": "string",
              "enum": ["file", "folder", "all"],
              "description": "Filter results by type: 'file' (files only), 'folder' (directories only), or 'all' (both). Default is 'all'."
            },
            "maxResults": {
              "type": "number",
              "description": "Maximum number of results to return. Default is 100."
            }
          },
          "required": ["connectionName", "pattern"]
        }
      },
      {
        "name": "sftp-plus_get_tree",
        "displayName": "Get Directory Tree",
        "toolReferenceName": "sftp-tree",
        "icon": "$(tools)",
        "modelDescription": "Returns the complete directory tree structure in a single call. Useful to understand the project structure before searching. More efficient than multiple list_files calls.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to use."
            },
            "path": {
              "type": "string",
              "description": "Starting path for the tree. Default is root '/'."
            },
            "maxDepth": {
              "type": "number",
              "description": "Maximum depth to traverse. Default is 5."
            },
            "includeFiles": {
              "type": "boolean",
              "description": "Include files in the tree output. Default is true. Set to false for folders-only structure."
            }
          },
          "required": ["connectionName"]
        }
      },
      {
        "name": "sftp-plus_get_sync_status",
        "displayName": "Get Sync Status",
        "toolReferenceName": "sftp-sync-status",
        "icon": "$(tools)",
        "modelDescription": "Returns the sync status of all tracked files for a connection. Shows which files have been modified locally vs remotely, which have original server backups, file sizes, and modification dates. Use this to monitor progress during batch operations and verify modifications. Files are tracked automatically when using sftp-plus_prepare_edit.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection to check sync status for."
            }
          },
          "required": ["connectionName"]
        }
      },
      {
        "name": "sftp-plus_restore_original",
        "displayName": "Restore Original",
        "toolReferenceName": "sftp-restore",
        "icon": "$(tools)",
        "modelDescription": "Restores the original server version of a file to the local working copy. Original backups are created automatically before the first modification via Copilot tools. The original backup is preserved after restore. Use this to rollback changes if something went wrong.",
        "canBeReferencedInPrompt": true,
        "inputSchema": {
          "type": "object",
          "properties": {
            "connectionName": {
              "type": "string",
              "description": "Name of the SFTP+ connection."
            },
            "path": {
              "type": "string",
              "description": "Remote path of the file to restore. Example: '/var/www/config.json'"
            }
          },
          "required": ["connectionName", "path"]
        }
      }
    ],
    "viewsContainers": {
      "activitybar": [
        {
          "id": "sftp-plus-explorer",
          "title": "SFTP+",
          "icon": "resources/icon.svg"
        }
      ]
    },
    "views": {
      "sftp-plus-explorer": [
        {
          "id": "sftp-plus.connections",
          "name": "Hosts"
        },
        {
          "type": "webview",
          "id": "sftp-plus.hostDetails",
          "name": "Details",
          "visibility": "visible"
        }
      ]
    },
    "viewsWelcome": [
      {
        "view": "sftp-plus.connections",
        "contents": "No hosts configured.\n[Add Host](command:sftp-plus.addConnection)\n\nMake sure rclone and WinFsp are installed.\n[Check Prerequisites](command:sftp-plus.checkPrerequisites)"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "sftp-plus.addConnection",
          "when": "view == sftp-plus.connections",
          "group": "navigation"
        },
        {
          "command": "sftp-plus.refresh",
          "when": "view == sftp-plus.connections",
          "group": "navigation"
        }
      ],
      "view/item/context": [
        {
          "command": "sftp-plus.connect",
          "when": "view == sftp-plus.connections && viewItem == disconnected",
          "group": "inline"
        },
        {
          "command": "sftp-plus.disconnect",
          "when": "view == sftp-plus.connections && viewItem =~ /^connected(-mcp)?$/",
          "group": "inline"
        },
        {
          "command": "sftp-plus.openInExplorer",
          "when": "view == sftp-plus.connections && viewItem =~ /^connected(-mcp)?$/",
          "group": "inline"
        },
        {
          "command": "sftp-plus.startMcp",
          "when": "view == sftp-plus.connections && viewItem == connected",
          "group": "inline"
        },
        {
          "command": "sftp-plus.stopMcp",
          "when": "view == sftp-plus.connections && viewItem == connected-mcp",
          "group": "inline"
        },
        {
          "command": "sftp-plus.editConnection",
          "when": "view == sftp-plus.connections && viewItem =~ /^(connected(-mcp)?|disconnected)$/",
          "group": "inline"
        },
        {
          "command": "sftp-plus.browseConnection",
          "when": "view == sftp-plus.connections && viewItem =~ /^connected(-mcp)?$/",
          "group": "1_open@1"
        },
        {
          "command": "sftp-plus.openInExplorer",
          "when": "view == sftp-plus.connections && viewItem =~ /^connected(-mcp)?$/",
          "group": "1_open@2"
        },
        {
          "command": "sftp-plus.startMcp",
          "when": "view == sftp-plus.connections && viewItem == connected",
          "group": "1_open@3"
        },
        {
          "command": "sftp-plus.stopMcp",
          "when": "view == sftp-plus.connections && viewItem == connected-mcp",
          "group": "1_open@3"
        },
        {
          "command": "sftp-plus.editConnection",
          "when": "view == sftp-plus.connections && viewItem =~ /^(connected(-mcp)?|disconnected)$/",
          "group": "2_modify"
        },
        {
          "command": "sftp-plus.removeConnection",
          "when": "view == sftp-plus.connections && viewItem =~ /^(connected(-mcp)?|disconnected)$/",
          "group": "3_remove"
        }
      ],
      "explorer/context": [
        {
          "command": "sftp-plus.uploadToHost",
          "when": "resourcePath =~ /\\.sftp-plus[\\\\/]/",
          "group": "7_modification"
        }
      ],
      "editor/context": [
        {
          "command": "sftp-plus.uploadToHost",
          "when": "resourcePath =~ /\\.sftp-plus[\\\\/]/",
          "group": "1_modification"
        }
      ],
      "editor/title/context": [
        {
          "command": "sftp-plus.uploadToHost",
          "when": "resourcePath =~ /\\.sftp-plus[\\\\/]/",
          "group": "1_modification"
        }
      ]
    },
    "configuration": {
      "title": "SFTP+",
      "properties": {
        "sftp-plus.connections": {
          "type": "array",
          "default": [],
          "description": "List of SFTP/FTPS server connections",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "Display name for this connection"
              },
              "host": {
                "type": "string",
                "description": "Server hostname or IP"
              },
              "port": {
                "type": "number",
                "default": 21,
                "description": "Server port"
              },
              "protocol": {
                "type": "string",
                "enum": [
                  "ftp",
                  "ftps",
                  "sftp"
                ],
                "default": "ftps",
                "description": "Connection protocol"
              },
              "username": {
                "type": "string",
                "description": "Username for authentication"
              },
              "remotePath": {
                "type": "string",
                "default": "/",
                "description": "Remote path to mount"
              },
              "driveLetter": {
                "type": "string",
                "description": "Windows drive letter (e.g., Z). Auto-assigned if empty."
              },
              "explicitTls": {
                "type": "boolean",
                "default": true,
                "description": "Use explicit TLS for FTPS"
              },
              "ignoreCertErrors": {
                "type": "boolean",
                "default": false,
                "description": "Ignore SSL certificate errors (for self-signed certs)"
              },
              "autoConnect": {
                "type": "boolean",
                "default": false,
                "description": "Auto-connect when VS Code starts"
              },
              "cacheMode": {
                "type": "string",
                "enum": [
                  "off",
                  "minimal",
                  "writes",
                  "full"
                ],
                "default": "full",
                "description": "VFS cache mode for performance"
              },
              "idleTimeout": {
                "type": "string",
                "default": "0",
                "description": "Keep-alive idle timeout (0 = disabled, stays connected)"
              }
            },
            "required": [
              "name",
              "host",
              "username"
            ]
          }
        },
        "sftp-plus.rclonePath": {
          "type": "string",
          "default": "",
          "description": "Custom path to rclone executable (leave empty for PATH lookup)"
        },
        "sftp-plus.showStatusBar": {
          "type": "boolean",
          "default": true,
          "description": "Show connection status in the status bar"
        },
        "sftp-plus.logLevel": {
          "type": "string",
          "enum": [
            "debug",
            "info",
            "warn",
            "error"
          ],
          "default": "info",
          "description": "Logging verbosity"
        }
      }
    }
  },
  "scripts": {
    "vscode:prepublish": "pnpm run compile",
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "lint": "eslint src --ext ts",
    "test": "node ./out/test/runTest.js",
    "package": "vsce package",
    "publish": "vsce publish"
  },
  "devDependencies": {
    "@types/node": "^22.x",
    "@types/vscode": "^1.96.0",
    "@typescript-eslint/eslint-plugin": "^8.x",
    "@typescript-eslint/parser": "^8.x",
    "@vscode/vsce": "^3.x",
    "eslint": "^9.x",
    "typescript": "^5.x"
  },
  "volta": {
    "node": "20.18.0",
    "pnpm": "9.15.0"
  },
  "dependencies": {
    "@vscode/codicons": "^0.0.44"
  }
}
